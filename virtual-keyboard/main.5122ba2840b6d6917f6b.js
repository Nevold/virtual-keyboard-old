(()=>{"use strict";const e=["`","1","2","3","4","5","6","7","8","9","0","-","=","backspace","tab","q","w","e","r","t","y","u","i","o","p","[","]","delete","capslock","a","s","d","f","g","h","j","k","l",";","'","enter","shift","z","x","c","v","b","n","m",",",".","/","arrowup","shift","control","meta","alt","space","alt","arrowleft","arrowdown","arrowright","control"],t=["~","!","@","#","$","%","^","&","*","(",")","_","+","q","w","e","r","t","y","u","i","o","p","{","}","a","s","d","f","g","h","j","k","l",":",'"',"z","x","c","v","b","n","m","<",">","?"],a=["`","1","2","3","4","5","6","7","8","9","0","-","=","q","w","e","r","t","y","u","i","o","p","[","]","a","s","d","f","g","h","j","k","l",";","'","z","x","c","v","b","n","m",",",".","/"],s=["ё","1","2","3","4","5","6","7","8","9","0","-","=","й","ц","у","к","е","н","г","ш","щ","з","х","ъ","ф","ы","в","а","п","р","о","л","д","ж","э","я","ч","с","м","и","т","ь","б","ю","."],r=["ё","!",'"',"№",";","%",":","?","*","(",")","_","+","й","ц","у","к","е","н","г","ш","щ","з","х","ъ","ф","ы","в","а","п","р","о","л","д","ж","э","я","ч","с","м","и","т","ь","б","ю",","],o={elements:{main:null,keysContainer:null,keys:[]},eventHandlers:{oninput:null},properties:{value:"",capsLock:!1,lang:!1},init(){this.elements.main=document.createElement("div"),this.elements.keysContainer=document.createElement("div"),this.elements.main.classList.add("keyboard"),this.elements.keysContainer.classList.add("keyboard__keys"),this.elements.keysContainer.appendChild(this.createKeys()),this.elements.keys=this.elements.keysContainer.querySelectorAll(".keyboard__key"),this.elements.main.appendChild(this.elements.keysContainer),document.body.appendChild(this.elements.main);const e=document.querySelector(".use-keyboard-input");let t;e.addEventListener("focus",(()=>{this.open(e.value,(a=>{t=[...a],t.pop(),e.value=t.join("")}))})),e.addEventListener("blur",(()=>{this.open(e.value,(t=>{e.value=t}))})),this.open(e.value,(t=>{e.value=t}))},createKeys(){const t=document.createDocumentFragment();return e.forEach((e=>{let a;const s=document.createElement("button"),r=-1!==["backspace","delete","enter","?"].indexOf(e);switch(e.length>1&&(s.dataset.name=e.toLocaleLowerCase()),(e.charCodeAt(0)>=65&&e.charCodeAt(0)<=90||e.charCodeAt(0)>=97&&e.charCodeAt(0)<=122)&&(s.dataset.letter=e.toLocaleLowerCase()),s.setAttribute("type","button"),s.classList.add("keyboard__key"),e){case"backspace":s.classList.add("keyboard__key--wide","func-keys"),s.innerHTML="Backspace",s.addEventListener("click",(()=>{this.properties.value=this.properties.value.substring(0,this.properties.value.length-1),this.triggerEvent("oninput")}));break;case"capslock":s.classList.add("keyboard__key--wide","keyboard__key--activatable","func-keys"),s.innerHTML="Caps",s.addEventListener("click",(()=>{this.toggleCapsLock(),s.classList.toggle("keyboard__key--active",this.properties.capsLock)}));break;case"enter":s.classList.add("keyboard__key--wide","func-keys"),s.innerHTML="Enter",s.addEventListener("click",(()=>{this.properties.value+="\n",this.triggerEvent("oninput")}));break;case"space":s.classList.add("keyboard__key--extra-wide","func-keys"),s.innerHTML="",s.addEventListener("click",(()=>{this.properties.value+=" ",this.triggerEvent("oninput")}));break;case"arrowup":s.classList.add("func-keys"),s.innerHTML="&#9650;",s.addEventListener("click",(()=>{this.properties.value+="▲",this.triggerEvent("oninput")}));break;case"arrowleft":s.classList.add("func-keys"),s.innerHTML="&#9668;",s.addEventListener("click",(()=>{this.properties.value+="◄",this.triggerEvent("oninput")}));break;case"arrowdown":s.classList.add("func-keys"),s.innerHTML="&#9660;",s.addEventListener("click",(()=>{this.properties.value+="▼",this.triggerEvent("oninput")}));break;case"arrowright":s.classList.add("func-keys"),s.innerHTML="&#9658;",s.addEventListener("click",(()=>{this.properties.value+="►",this.triggerEvent("oninput")}));break;case"shift":s.classList.add("keyboard__key--wide","func-keys"),s.innerHTML="Shift",s.addEventListener("mousedown",(()=>{this.toggleCapsLockShift()})),s.addEventListener("mouseup",(()=>{this.toggleCapsLockShift()}));break;case"control":s.classList.add("keyboard__key--bold","func-keys"),s.innerHTML="Ctrl";break;case"alt":s.classList.add("keyboard__key--bold","func-keys"),s.innerHTML="Alt";break;case"meta":s.classList.add("keyboard__key--bold","func-keys"),s.innerHTML="Win";break;case"delete":s.classList.add("keyboard__key--midlle-wide","func-keys"),s.innerHTML="Del",s.addEventListener("click",(()=>{const e=document.querySelector("textarea");0!==e.selectionStart&&(a=e.selectionStart);const t=[...this.properties.value];t.splice(0===e.selectionStart?a:e.selectionStart,1),this.properties.value=t.join(""),this.triggerEvent("oninput")}));break;case"tab":s.classList.add("keyboard__key--midlle-wide","func-keys"),s.innerHTML="Tab",s.addEventListener("click",(()=>{this.properties.value+="    ",this.triggerEvent("oninput")}));break;default:s.textContent=e.toLowerCase(),s.addEventListener("click",(()=>{this.properties.value+=s.textContent,this.triggerEvent("oninput")}))}t.appendChild(s),r&&t.appendChild(document.createElement("br"))})),window.addEventListener("keydown",(e=>{let t,a="",s="",r=[],o="";const i=/[А-Яа-я]/gi,c=/[ХхЪъЖжЭэБбЮюЁё]/gi;switch(e.key.length>1?(a=document.querySelector(`.keyboard__key[data-name=${String(e.key).toLowerCase()}]`),r=[...document.querySelectorAll(`.keyboard__key[data-name=${String(e.key).toLowerCase()}]`)]):s=document.querySelector(".keyboard__key--extra-wide"),e.key.toLocaleLowerCase()){case"backspace":this.properties.value=this.properties.value.substring(0,this.properties.value.length-1),this.triggerEvent("oninput"),a.classList.add("keyboard__key--active");break;case"capslock":this.toggleCapsLock(),a.classList.toggle("keyboard__key--active",this.properties.capsLock);break;case"enter":this.properties.value+="\n",this.triggerEvent("oninput"),a.classList.add("keyboard__key--active");break;case" ":this.properties.value+=" ",this.triggerEvent("oninput"),s.classList.add("keyboard__key--active");break;case"arrowup":this.properties.value+="▲",this.triggerEvent("oninput"),a.classList.add("keyboard__key--active");break;case"arrowleft":this.properties.value+="◄",this.triggerEvent("oninput"),a.classList.add("keyboard__key--active");break;case"arrowdown":this.properties.value+="▼",this.triggerEvent("oninput"),a.classList.add("keyboard__key--active");break;case"arrowright":this.properties.value+="►",this.triggerEvent("oninput"),a.classList.add("keyboard__key--active");break;case"shift":e.repeat||("ShiftLeft"===e.code?r[0].classList.add("keyboard__key--active"):r[1].classList.add("keyboard__key--active"),this.toggleCapsLockShift());break;case"control":"ControlLeft"===e.code?r[0].classList.add("keyboard__key--active"):r[1].classList.add("keyboard__key--active");break;case"alt":e.preventDefault(),"AltLeft"===e.code?r[0].classList.add("keyboard__key--active"):r[1].classList.add("keyboard__key--active");break;case"meta":a.classList.add("keyboard__key--active");break;case"delete":a.classList.add("keyboard__key--active");{const e=document.querySelector("textarea");0!==e.selectionStart&&(t=e.selectionStart);const a=[...this.properties.value];a.splice(0===e.selectionStart?t:e.selectionStart,1),this.properties.value=a.join(""),this.triggerEvent("oninput")}break;case"tab":e.preventDefault(),this.properties.value+="    ",this.triggerEvent("oninput"),a.classList.add("keyboard__key--active");break;default:if(this.properties.lang)switch(e.code.toLocaleLowerCase()){case"bracketleft":[...document.querySelectorAll(".keyboard__key")].filter((e=>e.textContent.toLowerCase().charCodeAt(0)==="х".charCodeAt(0)))[0].classList.add("keyboard__key--active"),this.properties.value+=this.properties.capsLock?"Х":"х";break;case"bracketright":[...document.querySelectorAll(".keyboard__key")].filter((e=>e.textContent.toLowerCase().charCodeAt(0)==="ъ".charCodeAt(0)))[0].classList.add("keyboard__key--active"),this.properties.value+=this.properties.capsLock?"Ъ":"ъ";break;case"semicolon":[...document.querySelectorAll(".keyboard__key")].filter((e=>e.textContent.toLowerCase().charCodeAt(0)==="ж".charCodeAt(0)))[0].classList.add("keyboard__key--active"),this.properties.value+=this.properties.capsLock?"Ж":"ж";break;case"quote":[...document.querySelectorAll(".keyboard__key")].filter((e=>e.textContent.toLowerCase().charCodeAt(0)==="э".charCodeAt(0)))[0].classList.add("keyboard__key--active"),this.properties.value+=this.properties.capsLock?"Э":"э";break;case"comma":[...document.querySelectorAll(".keyboard__key")].filter((e=>e.textContent.toLowerCase().charCodeAt(0)==="б".charCodeAt(0)))[0].classList.add("keyboard__key--active"),this.properties.value+=this.properties.capsLock?"Б":"б";break;case"period":[...document.querySelectorAll(".keyboard__key")].filter((e=>e.textContent.toLowerCase().charCodeAt(0)==="ю".charCodeAt(0)))[0].classList.add("keyboard__key--active"),this.properties.value+=this.properties.capsLock?"Ю":"ю";break;case"backquote":[...document.querySelectorAll(".keyboard__key")].filter((e=>e.textContent.toLowerCase().charCodeAt(0)==="ё".charCodeAt(0)))[0].classList.add("keyboard__key--active"),this.properties.value+=this.properties.capsLock?"Ё":"ё"}e.key.charCodeAt(0)>=65&&e.key.charCodeAt(0)<=90||e.key.charCodeAt(0)>=97&&e.key.charCodeAt(0)<=122||e.key.search(i)>=0&&-1===e.key.search(c)?o=document.querySelector(`.keyboard__key[data-letter=${[...e.code.toLowerCase()].pop()}]`):-1===e.key.search(c)&&([o]=[...document.querySelectorAll(".keyboard__key")].filter((t=>t.textContent.toLowerCase()===e.key.toLowerCase()))),o&&(this.properties.value+=o.textContent,o.classList.add("keyboard__key--active")),this.triggerEvent("oninput")}})),window.addEventListener("keyup",(e=>{let t="",a="",s=[],r="";const o=/[А-Яа-я]/gi,i=/[ХхЪъЖжЭэБбЮюЁё]/gi;switch(e.key.length>1?(t=document.querySelector(`.keyboard__key[data-name=${String(e.key).toLowerCase()}]`),s=[...document.querySelectorAll(`.keyboard__key[data-name=${String(e.key).toLowerCase()}]`)]):a=document.querySelector(".keyboard__key--extra-wide"),e.key.toLocaleLowerCase()){case"backspace":case"enter":case"arrowup":case"arrowleft":case"arrowdown":case"arrowright":case"meta":case"delete":case"tab":t.classList.remove("keyboard__key--active");break;case" ":a.classList.remove("keyboard__key--active");break;case"shift":e.repeat||("ShiftLeft"===e.code?s[0].classList.remove("keyboard__key--active"):s[1].classList.remove("keyboard__key--active"),this.toggleCapsLockShift());break;case"control":"ControlLeft"===e.code?s[0].classList.remove("keyboard__key--active"):s[1].classList.remove("keyboard__key--active");break;case"alt":e.repeat||("AltLeft"===e.code?s[0].classList.remove("keyboard__key--active"):s[1].classList.remove("keyboard__key--active"));break;default:if(this.properties.lang)switch(e.code.toLocaleLowerCase()){case"bracketleft":[...document.querySelectorAll(".keyboard__key")].filter((e=>e.textContent.toLowerCase().charCodeAt(0)==="х".charCodeAt(0)))[0].classList.remove("keyboard__key--active");break;case"bracketright":[...document.querySelectorAll(".keyboard__key")].filter((e=>e.textContent.toLowerCase().charCodeAt(0)==="ъ".charCodeAt(0)))[0].classList.remove("keyboard__key--active");break;case"semicolon":[...document.querySelectorAll(".keyboard__key")].filter((e=>e.textContent.toLowerCase().charCodeAt(0)==="ж".charCodeAt(0)))[0].classList.remove("keyboard__key--active");break;case"quote":[...document.querySelectorAll(".keyboard__key")].filter((e=>e.textContent.toLowerCase().charCodeAt(0)==="э".charCodeAt(0)))[0].classList.remove("keyboard__key--active");break;case"comma":[...document.querySelectorAll(".keyboard__key")].filter((e=>e.textContent.toLowerCase().charCodeAt(0)==="б".charCodeAt(0)))[0].classList.remove("keyboard__key--active");break;case"period":[...document.querySelectorAll(".keyboard__key")].filter((e=>e.textContent.toLowerCase().charCodeAt(0)==="ю".charCodeAt(0)))[0].classList.remove("keyboard__key--active");break;case"backquote":[...document.querySelectorAll(".keyboard__key")].filter((e=>e.textContent.toLowerCase().charCodeAt(0)==="ё".charCodeAt(0)))[0].classList.remove("keyboard__key--active")}e.key.charCodeAt(0)>=65&&e.key.charCodeAt(0)<=90||e.key.charCodeAt(0)>=97&&e.key.charCodeAt(0)<=122||e.key.search(o)>=0&&-1===e.key.search(i)?r=document.querySelector(`.keyboard__key[data-letter=${[...e.code.toLowerCase()].pop()}]`):-1===e.key.search(i)&&([r]=[...document.querySelectorAll(".keyboard__key")].filter((t=>t.textContent.toLowerCase()===e.key.toLowerCase()))),r&&r.classList.remove("keyboard__key--active")}})),document.addEventListener("keydown",(e=>{e.ctrlKey&&e.altKey&&(this.properties.lang?localStorage.setItem("lang","en"):localStorage.setItem("lang","ru"),this.toggleLanguageLayout())})),t},triggerEvent(e){"function"==typeof this.eventHandlers[e]&&this.eventHandlers[e](this.properties.value)},toggleCapsLock(){this.properties.capsLock=!this.properties.capsLock;const e=[...this.elements.keys].filter((e=>!e.classList.contains("func-keys")));for(const t of e)0===t.childElementCount&&(t.textContent=this.properties.capsLock?t.textContent.toUpperCase():t.textContent.toLowerCase())},toggleCapsLockShift(){this.properties.capsLock=!this.properties.capsLock,[...this.elements.keys].filter((e=>!e.classList.contains("func-keys"))).forEach(((e,o)=>{0===e.childElementCount&&(this.properties.lang?e.textContent=this.properties.capsLock?r[o]:s[o]:e.textContent=this.properties.capsLock?t[o]:a[o],e.textContent=this.properties.capsLock?e.textContent.toUpperCase():e.textContent.toLowerCase())}))},toggleLanguageLayout(){this.properties.lang=!this.properties.lang,[...this.elements.keys].filter((e=>!e.classList.contains("func-keys"))).forEach(((e,t)=>{0===e.childElementCount&&(this.properties.capsLock?e.textContent=this.properties.lang?s[t].toLocaleUpperCase():a[t].toLocaleUpperCase():e.textContent=this.properties.lang?s[t]:a[t])}))},open(e,t){this.properties.value=e||"",this.eventHandlers.oninput=t}};window.onload=()=>{const e=document.createElement("h1");e.classList.add("header"),e.innerHTML="RSS Virtual Keyboard",document.body.append(e);const t=document.createElement("textarea");t.classList.add("use-keyboard-input"),document.body.append(t),o.init();const a=document.createElement("div");a.classList.add("footer"),a.innerHTML="\n    <p>Created in the <span>Windows</span> operating system</p>\n    <p>Press the <span>Ctrl</span> + <span>Alt</span> to switch the keyboard language layout</p>\n  ",document.body.append(a),"ru"===localStorage.getItem("lang")&&o.toggleLanguageLayout()}})();